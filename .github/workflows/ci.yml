name: RAG CI Pipeline
on:
  push:
    paths:
      - 'knowledge_base/**'
      - 'app.py'
      - 'embed.py'
jobs:
  test-and-build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.13'
      - name: Install dependencies
        run: |
          pip install fastapi uvicorn chromadb requests
      - name: Rebuild embeddings
        run: python embed.py knowledge_base
      - name: Start API in mock mode
        run: |
          USE_MOCK_LLM=1 fastapi run app.py --port 8000
          sleep 5
      - name: Run semantic tests
        run: python semantic_test.py
      - name: Success
        run: echo "All tests passed!"
